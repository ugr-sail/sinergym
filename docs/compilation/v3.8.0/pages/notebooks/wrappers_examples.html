

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wrappers example &mdash; Sinergym  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../../_static/doc_theme.css?v=23b407c1" />
      <link rel="stylesheet" type="text/css" href="../../_static/github_style.css?v=0a3c596a" />

  
    <link rel="shortcut icon" href="../../_static/logo-sidebar.png"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="LoggerWrapper customization" href="personalize_loggerwrapper.html" />
    <link rel="prev" title="Default building control using an empty action space" href="default_building_control.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #a5beba" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Sinergym
              <img src="../../_static/logo-sidebar.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage-example.html">Usage example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sinergym</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../buildings.html">Buildings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../weathers.html">Weathers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environments_registration.html">Environments configuration and registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging system overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output.html">Sinergym output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rewards.html">Rewards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wrappers.html">Wrappers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra-configuration.html">Extra configuration in Sinergym simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep-reinforcement-learning.html">Deep Reinforcement Learning integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcloudAPI.html">Google Cloud integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../github-actions.html">Github actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests.html">Tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basic_example.html">Basic example</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_env_information.html">Getting information about Sinergym environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="sinergym_package.html">Sinergym package information</a></li>
<li class="toctree-l1"><a class="reference internal" href="change_environment.html">Changing an environment registered in Sinergym</a></li>
<li class="toctree-l1"><a class="reference internal" href="default_building_control.html">Default building control using an empty action space</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Wrappers example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Multi-objective-wrapper">Multi-objective wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Previous-observation-wrappers">Previous observation wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Datetime-wrapper">Datetime wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Action-normalization-wrapper">Action normalization wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Action-discretization-wrapper">Action discretization wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Discrete-incremental-wrapper">Discrete incremental wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Normalization-wrapper">Normalization wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Logging-and-storing-data-with-logger-wrappers">Logging and storing data with logger wrappers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#LoggerWrapper-layer">LoggerWrapper layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#LoggerCSV-layer">LoggerCSV layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#WandBLogger-layer">WandBLogger layer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Multi-observation-wrapper">Multi-observation wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Weather-forecasting-wrapper">Weather forecasting wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Energy-cost-wrapper">Energy cost wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Nesting-wrappers">Nesting wrappers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="personalize_loggerwrapper.html">LoggerWrapper customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging_unused_variables.html">Logging unused variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="rule_controller_example.html">Rule-based controller example</a></li>
<li class="toctree-l1"><a class="reference internal" href="drl.html">DRL usage example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../API-reference.html">API reference</a></li>
</ul>

  <div class="sidebar-block github-block">
    <h3><i class="fa fa-github"></i> GitHub</h3>
    <ul class="simple">
      <li><a href="https://github.com/ugr-sail/sinergym" target="_blank">
        <i class="fa fa-book"></i> Repository
      </a></li>
      <li><a href="https://github.com/ugr-sail/sinergym/issues" target="_blank">üêû Issues</a></li>
      <li><a href="https://github.com/ugr-sail/sinergym/releases" target="_blank">üöÄ Releases</a></li>
    </ul>
  </div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #a5beba" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sinergym</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Wrappers example</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ugr-sail/sinergym/blob/main/docs/source/pages/notebooks/wrappers_examples.nblink" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Wrappers-example">
<h1>Wrappers example<a class="headerlink" href="#Wrappers-example" title="Link to this heading">ÔÉÅ</a></h1>
<p>In this notebook, we will explore <em>Sinergym</em>‚Äôs pre-defined wrappers and how to use them.</p>
<p>You can also create your own wrappers by inheriting from <em>gym.Wrapper</em> or any of its variants.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gymnasium</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gym</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sinergym</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sinergym.utils.wrappers</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<section id="Multi-objective-wrapper">
<h2>Multi-objective wrapper<a class="headerlink" href="#Multi-objective-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p><a class="reference external" href="https://github.com/Farama-Foundation/MO-Gymnasium">MO-Gymnasium</a> is an open-source Python library for developing and comparing multi-objective reinforcement learning algorithms.</p>
<p>Available MO-Gymnasium environments return a reward vector instead of a scalar value, one for each objective.</p>
<p>This wrapper enables <em>Sinergym</em> to return a reward vector. This way, <em>Sinergym</em> is made compatible with both multi-objective algorithms and algorithms that work with a traditional reward value.</p>
<p>We can transform the returned reward into a vector using as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-discrete-v1&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">MultiObjectiveReward</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">reward_terms</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;energy_term&#39;</span><span class="p">,</span> <span class="s1">&#39;comfort_term&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Make sure that <code class="docutils literal notranslate"><span class="pre">reward_terms</span></code> are available in the <code class="docutils literal notranslate"><span class="pre">info</span></code> dict returned by the environment‚Äôs <code class="docutils literal notranslate"><span class="pre">step</span></code> method. Otherwise, an execution error will occur.</p>
<p>By default, <em>Sinergym</em> environments return all reward terms of the reward class in the <code class="docutils literal notranslate"><span class="pre">info</span></code> dict.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">terminated</span><span class="p">,</span> <span class="n">truncated</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Previous-observation-wrappers">
<h2>Previous observation wrappers<a class="headerlink" href="#Previous-observation-wrappers" title="Link to this heading">ÔÉÅ</a></h2>
<p>This wrapper will add previous timestep observation values to the current environment observation.</p>
<p>You can select the variables whose previous observed values should be tracked. The observation space will be updated with the corresponding new dimension.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-discrete-v1&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">PreviousObservationWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">previous_variables</span><span class="o">=</span><span class="p">[</span>
    <span class="s1">&#39;htg_setpoint&#39;</span><span class="p">,</span>
    <span class="s1">&#39;clg_setpoint&#39;</span><span class="p">,</span>
    <span class="s1">&#39;air_temperature&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>You can see how the observation values have been updated:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
<span class="n">obs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;observation_variables&#39;</span><span class="p">),</span> <span class="n">obs</span><span class="p">))</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NEW OBSERVATION: &#39;</span><span class="p">,</span> <span class="n">obs_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Datetime-wrapper">
<h2>Datetime wrapper<a class="headerlink" href="#Datetime-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p>This wrapper will replace the <code class="docutils literal notranslate"><span class="pre">day</span></code> value with the <code class="docutils literal notranslate"><span class="pre">is_weekend</span></code> flag, and <code class="docutils literal notranslate"><span class="pre">hour</span></code> and <code class="docutils literal notranslate"><span class="pre">month</span></code> with codified <em>sin</em> and <em>cos</em> values.</p>
<p>The observation space is also automatically updated.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-discrete-v1&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">DatetimeWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This wrapper removes the observation variables <code class="docutils literal notranslate"><span class="pre">month</span></code>, <code class="docutils literal notranslate"><span class="pre">day</span></code>, and <code class="docutils literal notranslate"><span class="pre">hour</span></code>, and replace them by <code class="docutils literal notranslate"><span class="pre">month_sin</span></code>, <code class="docutils literal notranslate"><span class="pre">month_cos</span></code>, <code class="docutils literal notranslate"><span class="pre">is_weekend</span></code>, <code class="docutils literal notranslate"><span class="pre">hour_sin</span></code>, and <code class="docutils literal notranslate"><span class="pre">hour_cos</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
<span class="n">obs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;observation_variables&#39;</span><span class="p">),</span> <span class="n">obs</span><span class="p">))</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NEW OBSERVATION: &#39;</span><span class="p">,</span> <span class="n">obs_dict</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NEW OBSERVATION: &#39;</span><span class="p">,</span> <span class="n">obs_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Action-normalization-wrapper">
<h2>Action normalization wrapper<a class="headerlink" href="#Action-normalization-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p>Here‚Äôs an example of how to normalize a continuous action space using the <code class="docutils literal notranslate"><span class="pre">NormalizeAction</span></code> wrapper.</p>
<p>If the normalization range is not defined, it will be <code class="docutils literal notranslate"><span class="pre">[-1,1]</span></code> by default.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a continuous environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-continuous-v1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ORIGINAL ACTION SPACE: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;action_space&#39;</span><span class="p">))</span>

<span class="c1"># Apply the normalization wrapper</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">NormalizeAction</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">normalize_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WRAPPED ACTION SPACE: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;action_space&#39;</span><span class="p">))</span>

<span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normalized action: &#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Action performed in the simulator: &#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Action-discretization-wrapper">
<h2>Action discretization wrapper<a class="headerlink" href="#Action-discretization-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p>Let‚Äôs see how to discretize a continuous action space. We will need to specify the <strong>new discrete action space</strong> and an <strong>action mapping function</strong> whose output matches the original unwrapped action space:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We will create a continuous environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-continuous-v1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ORIGINAL ACTION SPACE: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;action_space&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;IS DISCRETE?: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;is_discrete&#39;</span><span class="p">))</span>

<span class="c1"># Defining new discrete space and action mapping function</span>
<span class="n">new_discrete_space</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Action values [0,9]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">action_mapping_function</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>  <span class="c1"># These lists match with the original action space</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">29</span><span class="p">],</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">28</span><span class="p">],</span>
        <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span>
        <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span> <span class="mi">26</span><span class="p">],</span>
        <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
        <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">24</span><span class="p">],</span>
        <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>
        <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mf">22.5</span><span class="p">],</span>
        <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mf">22.5</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">action</span><span class="p">]</span>


<span class="c1"># Apply the discretization wrapper</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">DiscretizeEnv</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">discrete_space</span><span class="o">=</span><span class="n">new_discrete_space</span><span class="p">,</span>
                    <span class="n">action_mapping</span><span class="o">=</span><span class="n">action_mapping_function</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WRAPPED ACTION SPACE: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;action_space&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;IS DISCRETE?: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;is_discrete&#39;</span><span class="p">))</span>
<span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ACTION DISCRETE: &#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Action done in simulator: &#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Discrete-incremental-wrapper">
<h2>Discrete incremental wrapper<a class="headerlink" href="#Discrete-incremental-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p>This wrapper updates an environment to utilize an incremental setpoint action space.It converts the environment into a <em>discrete</em> environment with an action mapping function and action space depending on the <code class="docutils literal notranslate"><span class="pre">step</span></code> and <code class="docutils literal notranslate"><span class="pre">delta</span></code> values specified.</p>
<p>The action is added to the <strong>current setpoint</strong> value instead of overwriting the latest action. Thus, the action is the current setpoint values with the applied increment/decrement, rather than the discrete value action that defines the increment/decrement itself.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-continuous-v1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ORIGINAL ACTION SPACE: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;action_space&#39;</span><span class="p">))</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">DiscreteIncrementalWrapper</span><span class="p">(</span>
    <span class="n">env</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">[</span><span class="mf">21.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">],</span> <span class="n">delta_temp</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">step_temp</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WRAPPED ACTION SPACE: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;action_space&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WRAPPED ACTION MAPPING: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;action_mapping&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The maximum and minimum values defined when creating the action mapping are read from the environment action space, ensuring that the setpoint increments and decrements do not exceed the corresponding limits.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">delta</span></code> and <code class="docutils literal notranslate"><span class="pre">step</span></code> values are used to determine how the discrete space of these increments and decrements will be constructed.</p>
<p>Here‚Äôs an example of how it works:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CURRENT SETPOINTS VALUES: &#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;current_setpoints&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Action number &#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span>
          <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;action_mapping&#39;</span><span class="p">)(</span><span class="n">action</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setpoints update: &#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Normalization-wrapper">
<h2>Normalization wrapper<a class="headerlink" href="#Normalization-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p>This wrapper is used to transform observations received from the simulator to values between in range <code class="docutils literal notranslate"><span class="pre">[-1,</span> <span class="pre">1]</span></code>.</p>
<p>It is based on <a class="reference external" href="https://gymnasium.farama.org/_modules/gymnasium/wrappers/normalize/#NormalizeObservation">Gymnasium‚Äôs dynamic normalization wrapper</a>.</p>
<p>Until properly calibrated, it may not be precise, and the values may often be out of range, so use this wrapper with caution.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Original env</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-discrete-v1&#39;</span><span class="p">)</span>

<span class="c1"># Normalized env</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">NormalizeObservation</span><span class="p">(</span>
    <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can check how the specified variables have been correctly normalized:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">obs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
<span class="n">obs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;observation_variables&#39;</span><span class="p">),</span> <span class="n">obs</span><span class="p">))</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION WITH NORMALIZATION: &#39;</span><span class="p">,</span> <span class="n">obs_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Logging-and-storing-data-with-logger-wrappers">
<h2>Logging and storing data with logger wrappers<a class="headerlink" href="#Logging-and-storing-data-with-logger-wrappers" title="Link to this heading">ÔÉÅ</a></h2>
<section id="LoggerWrapper-layer">
<h3>LoggerWrapper layer<a class="headerlink" href="#LoggerWrapper-layer" title="Link to this heading">ÔÉÅ</a></h3>
<p>This wrapper uses <em>Sinergym</em>‚Äôs <code class="docutils literal notranslate"><span class="pre">LoggerStorage</span></code> class to properly capture the interaction flow with the environment.</p>
<p>The class used by the wrapper can be replaced with a different back-end. It can then be combined with different wrappers to save the stored data, such as <code class="docutils literal notranslate"><span class="pre">CSVLogger</span></code> or <code class="docutils literal notranslate"><span class="pre">WandBLogger</span></code>. For more information about <em>Sinergym</em>‚Äôs logger, visit <a class="reference external" href="https://ugr-sail.github.io/sinergym/compilation/main/pages/logging.html#logging-system-overview">Logging System Overview</a>, <a class="reference external" href="https://ugr-sail.github.io/sinergym/compilation/main/pages/wrappers.html#logger-wrappers">Logger Wrappers</a> and <a class="reference external" href="https://ugr-sail.github.io/sinergym/compilation/main/pages/notebooks/personalize_loggerwrapper.html">an example
about custom loggers</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-discrete-v1&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">LoggerWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">storage_class</span><span class="o">=</span><span class="n">LoggerStorage</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This wrapper enables the use of a <code class="docutils literal notranslate"><span class="pre">LoggerStorage</span></code> instance within the environment class and automatically captures interaction data while actions are sent by an agent. At each reset, the data from this class is cleared to start the next episode. The idea is to combine it with other output loggers like those listed below:</p>
</section>
<section id="LoggerCSV-layer">
<h3>LoggerCSV layer<a class="headerlink" href="#LoggerCSV-layer" title="Link to this heading">ÔÉÅ</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">CSVLogger</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

<span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">truncated</span> <span class="o">=</span> <span class="n">terminated</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">current_month</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">terminated</span> <span class="ow">or</span> <span class="n">truncated</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">terminated</span><span class="p">,</span> <span class="n">truncated</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Once the <code class="docutils literal notranslate"><span class="pre">LoggerWrapper</span></code> is applied, this wrapper can be used to output episode data through <em>Sinergym</em>‚Äôs output, along with summary metrics added to CSV files. More details on this structure can be found in <a class="reference external" href="https://ugr-sail.github.io/sinergym/compilation/main/pages/output.html">OutputFormat</a>.</p>
<p><em>Sinergym</em> will raise an error if this wrapper is used without first enabling <code class="docutils literal notranslate"><span class="pre">LoggerWrapper</span></code> or a similar custom logger.</p>
</section>
<section id="WandBLogger-layer">
<h3>WandBLogger layer<a class="headerlink" href="#WandBLogger-layer" title="Link to this heading">ÔÉÅ</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># env = WandBLogger(env = Env,</span>
<span class="c1">#                 entity = &lt;wandb_account_entity&gt;,</span>
<span class="c1">#                 project_name = &lt;wandb_project_name&gt;,</span>
<span class="c1">#                 run_name = &lt;run_name&gt;</span>
<span class="c1">#                 group = &#39;Notebook_example&#39;,</span>
<span class="c1">#                 tags: [&#39;tag1&#39;,&#39;tag2&#39;],</span>
<span class="c1">#                 save_code = False,</span>
<span class="c1">#                 dump_frequency = 1000,</span>
<span class="c1">#                 artifact_save = True,</span>
<span class="c1">#                 artifact_type = &#39;output&#39;,</span>
<span class="c1">#                 excluded_info_keys = [&#39;reward&#39;,</span>
<span class="c1">#                                   &#39;action&#39;,</span>
<span class="c1">#                                   &#39;timestep&#39;,</span>
<span class="c1">#                                   &#39;month&#39;,</span>
<span class="c1">#                                   &#39;day&#39;,</span>
<span class="c1">#                                   &#39;hour&#39;,</span>
<span class="c1">#                                   &#39;time_elapsed(hours)&#39;,</span>
<span class="c1">#                                   &#39;reward_weight&#39;,</span>
<span class="c1">#                                   &#39;is_raining&#39;],</span>
<span class="c1">#                 excluded_episode_summary_keys = [&#39;terminated&#39;,</span>
<span class="c1">#                                              &#39;truncated&#39;]):</span>

<span class="c1"># env.reset()</span>
<span class="c1"># truncated = terminated = False</span>
<span class="c1"># current_month = 0</span>
<span class="c1"># while not (terminated or truncated):</span>
<span class="c1">#     a = env.action_space.sample()</span>
<span class="c1">#     _,_,terminated,truncated,_=env.step(a)</span>
<span class="c1"># env.close()</span>
</pre></div>
</div>
</div>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">CSVLogger</span></code>, this wrapper requires the environment to have been previously encapsulated by a <code class="docutils literal notranslate"><span class="pre">LoggerWrapper</span></code> or any custom logger.</p>
<p>The user must have a pre-existing <strong>Weights and Biases</strong> account and correctly configured it.</p>
<p>This wrapper does not override <code class="docutils literal notranslate"><span class="pre">CSVLogger</span></code>, so both can be applied simultaneously.</p>
</section>
</section>
<section id="Multi-observation-wrapper">
<h2>Multi-observation wrapper<a class="headerlink" href="#Multi-observation-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p>This wrapper stacks observations in a history queue, whose size can be customized:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Original environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-discrete-v1&#39;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE MULTI OBSERVATION: &#39;</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>

<span class="c1"># Multi-observation environment with a queue of size 5</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">MultiObsWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The result is:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MULTI OBSERVATION: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Weather-forecasting-wrapper">
<h2>Weather forecasting wrapper<a class="headerlink" href="#Weather-forecasting-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p>This wrapper adds weather forecast information to the current observation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Original environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-discrete-v1&#39;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION VARIABLES BEFORE WEATHER FORECASTING: &#39;</span><span class="p">,</span>
      <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;observation_variables&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION BEFORE WEATHER FORECASTING: &#39;</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>

<span class="c1"># Weather forecasting environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">WeatherForecastingWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We can observe the results:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION VARIABLES AFTER WEATHER FORECASTING: &#39;</span><span class="p">,</span>
      <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;observation_variables&#39;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION AFTER WEATHER FORECASTING: &#39;</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Energy-cost-wrapper">
<h2>Energy cost wrapper<a class="headerlink" href="#Energy-cost-wrapper" title="Link to this heading">ÔÉÅ</a></h2>
<p>This wrapper adds energy cost information to the current observation:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Original environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-discrete-v1&#39;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION VARIABLES BEFORE ADDING ENERGY COST: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
      <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;observation_variables&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION VALUES BEFORE ADDING ENERGY COST: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>

<span class="c1"># Energy Cost environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">EnergyCostWrapper</span><span class="p">(</span>
    <span class="n">env</span><span class="p">,</span> <span class="n">energy_cost_data_path</span><span class="o">=</span><span class="s1">&#39;/workspaces/sinergym/sinergym/data/energy_cost/PVPC_active_energy_billing_Iberian_Peninsula_2023.csv&#39;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>This is the result:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION VARIABLES AFTER ADDING ENERGY COST: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get_wrapper_attr</span><span class="p">(</span><span class="s1">&#39;observation_variables&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OBSERVATION VALUES AFTER ADDING ENERGY COST: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Nesting-wrappers">
<h2>Nesting wrappers<a class="headerlink" href="#Nesting-wrappers" title="Link to this heading">ÔÉÅ</a></h2>
<p>All wrappers included in <em>Sinergym</em> are stackable and organized in layers. However, the order in which these layers are applied can affect the final result, depending on the wrappers being used.</p>
<p>For instance, applying the logger before normalizing differs from doing it in the reverse order. In the first case, the data will be logged without normalization, even though the agent will operate in a normalized environment. In the second case, the logger will capture the normalized values since it encapsulates the normalization applied by the previous layer.</p>
<p>An example of how to nest wrappers is shown below:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;Eplus-5zone-hot-continuous-v1&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">MultiObjectiveReward</span><span class="p">(</span>
    <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
    <span class="n">reward_terms</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;energy_term&#39;</span><span class="p">,</span>
        <span class="s1">&#39;comfort_term&#39;</span><span class="p">])</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">PreviousObservationWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">previous_variables</span><span class="o">=</span><span class="p">[</span>
    <span class="s1">&#39;htg_setpoint&#39;</span><span class="p">,</span>
    <span class="s1">&#39;clg_setpoint&#39;</span><span class="p">,</span>
    <span class="s1">&#39;air_temperature&#39;</span><span class="p">])</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">DatetimeWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">DiscreteIncrementalWrapper</span><span class="p">(</span>
    <span class="n">env</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">[</span><span class="mf">21.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">],</span> <span class="n">delta_temp</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">step_temp</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">NormalizeObservation</span><span class="p">(</span>
    <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">LoggerWrapper</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">MultiObsWrapper</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we can simply use the wrapped environment as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">truncated</span> <span class="o">=</span> <span class="n">terminated</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">current_month</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">terminated</span> <span class="ow">or</span> <span class="n">truncated</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">terminated</span><span class="p">,</span> <span class="n">truncated</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_month</span><span class="p">:</span>  <span class="c1"># display results every month</span>
            <span class="n">current_month</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reward: &#39;</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="default_building_control.html" class="btn btn-neutral float-left" title="Default building control using an empty action space" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="personalize_loggerwrapper.html" class="btn btn-neutral float-right" title="LoggerWrapper customization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, J. Jim√©nez, J. G√≥mez, M. Molina, A. Manjavacas, A. Campoy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: v3.8.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../../v1.4.0/index.html">v1.4.0</a></dd>
            <dd><a href="../../../v1.6.0/index.html">v1.6.0</a></dd>
            <dd><a href="../../../v1.7.0/index.html">v1.7.0</a></dd>
            <dd><a href="../../../v2.0.0/index.html">v2.0.0</a></dd>
            <dd><a href="../../../v2.1.0/index.html">v2.1.0</a></dd>
            <dd><a href="../../../v2.2.0/index.html">v2.2.0</a></dd>
            <dd><a href="../../../v2.3.0/index.html">v2.3.0</a></dd>
            <dd><a href="../../../v2.5.0/index.html">v2.5.0</a></dd>
            <dd><a href="../../../v3.1.0/index.html">v3.1.0</a></dd>
            <dd><a href="../../../v3.2.0/index.html">v3.2.0</a></dd>
            <dd><a href="../../../v3.3.0/index.html">v3.3.0</a></dd>
            <dd><a href="../../../v3.4.0/index.html">v3.4.0</a></dd>
            <dd><a href="../../../v3.5.0/index.html">v3.5.0</a></dd>
            <dd><a href="../../../v3.6.0/index.html">v3.6.0</a></dd>
            <dd><a href="../../../v3.7.0/index.html">v3.7.0</a></dd>
            <dd><a href="wrappers_examples.html">v3.8.0</a></dd>
            <dd><a href="../../../v3.9.0/index.html">v3.9.0</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../main/index.html">main</a></dd>
        </dl>
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>